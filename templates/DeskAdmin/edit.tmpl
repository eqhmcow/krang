<tmpl_include header.tmpl>

<script language=javascript>
 function checkall(checkbox, prefix) {
     for (var i = 0; i < checkbox.form.elements.length ; i++) {
        var e = checkbox.form.elements[i];
        if (e.name && e.name.indexOf(prefix) == 0) {
           e.checked = checkbox.checked;
        }
     }
  }

  function delete_selected () {
        var myform = document.forms["current_desk_form"];
        myform.submit();
  }

  function reorder () {
        var myform = document.forms["current_desk_form"];
        myform.rm.value = "reorder";
        myform.submit();
  }

  // updates the order pull downs to stay consistent
function update_order(obj, prefix) {
    var form  = obj.form;
    var requestedIndex = obj.selectedIndex;
    var i;
                                                                                
    // get list of relevent form elements
    var elem = new Array();
    for (i = 0; i < form.elements.length ; i++) {
        var e = form.elements[i];
        if (e.name && e.name.indexOf(prefix) == 0 && e.options) {
           elem.push(e);
        }
     }
                                                                                
    // sort them by their indexes
    chosenOne = obj;
    elem.sort(update_order_sort_south);
                                                                                
    // did that do it?
    if (elem[requestedIndex] != obj) {
        // the opposite bias must be right
        elem.sort(update_order_sort_north);
    }
                                                                                
    // walk through the elements handing out indexes
    for (i = 0; i < elem.length; i++) {
        elem[i].selectedIndex = i;
    }
}

// special sort functions that sort by selectedIndex and bias the
// "chosenOne" to either get sorted higher or lower.
                                                                                
var chosenOne;
function update_order_sort_north (a, b) {
    if (a.selectedIndex < b.selectedIndex) { return -1; }
    if (a.selectedIndex > b.selectedIndex) { return  1; }
    if (a == chosenOne) { return -1; }
    if (b == chosenOne) { return 1; }
    return 0;
}
function update_order_sort_south (a, b) {
    if (a.selectedIndex < b.selectedIndex) { return -1; }
    if (a.selectedIndex > b.selectedIndex) { return  1; }
    if (a == chosenOne) { return 1; }
    if (b == chosenOne) { return -1; }
    return 0;
}

</script>

<div class=dark-bar>Desk Editor</div>
<br>
<TMPL_IF existing_desk_loop>
<form name="current_desk_form" method="POST">
<input type="hidden" name="total_desks" value="<tmpl_var total_desks>" override='1'>
<input type="hidden" name="rm" value="delete" override='1'>
  <table cellspacing="0" width="100%">
                                                                        
      <tr class="form-head">
          <th>Name</th>
          <th>Order</th>
          <th align="right"><input type="checkbox" name="checkallbox" value="1" onClick="checkall(this, 'desk_delete_list')"></th>
      </tr>
                                                                        
  <tmpl_loop existing_desk_loop>
      <tr>
          <td class="form-cell"><tmpl_var ESCAPE=HTML name></td>
          <td class="form-cell" align="right"><select onchange="update_order(this, 'order_')" name="order_<tmpl_var desk_id>"><tmpl_loop desk_count_loop><option value="<tmpl_var count>" <tmpl_if selected>selected</tmpl_if>><tmpl_var count></tmpl_loop></td>
          <td class="form-cell" align="right"><input type="checkbox" name="desk_delete_list" value="<tmpl_var ESCAPE=HTML desk_id>"></td>
      </tr>
  </tmpl_loop>
  </table>
  <div align="right">
<input type="button" value="Reorder Desks" onClick="reorder()">&nbsp;
<input type="button" value="Delete Checked" onClick="delete_selected()"></div>
</form>                                                                      
<TMPL_ELSE>
  <b>No Desks Found</b><br><br>
</TMPL_IF>
<div class=form-box>

<form name="add_desk_form" method="POST">
<table cellspacing="0" width="100%">
<input type="hidden" name="rm" value="add" override='1'>
      <tr class="form-head">
          <th colspan=2 align=left>Add New Desk</th>
      </tr>
        <tr>
            <td>Name:</td>
            <td><input <tmpl_if no_name>class="invalid"</tmpl_if> name="name" type="text" value="<tmpl_var name>"></td>
        </tr>
        <tr>
            <td>Order:</td>
            <td><tmpl_var order_selector></td>
        </tr>
<tr><td>&nbsp;</td><td><input type=button value="Add Desk" onclick="submit()"></td></tr>
</table>
</form>
</div>


<div class=button-bar>
&nbsp;<br><br>
</div>

<tmpl_include footer.tmpl>
