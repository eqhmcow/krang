<tmpl_include header.tmpl>

<script type="text/javascript">
Krang.onload( function() {
  Krang.Nav.edit_mode();
  Krang.Help.set();
} );

add_contrib = function()
{
  Krang.Form.submit('add_contrib_form', {}, { to_top: false });
}

<tmpl_if associated_contributors>
  reorder_contributors = function()
  {
    Krang.Form.submit('current_contributors_form', { rm: 'reorder_contribs' }, { to_top: false });
  }

  unassociate_selected = function()
  {

    if ( !Krang.row_checked( 'current_contributors_form', 'contrib_unassociate_list' ) )
      alert( 'Nothing selected to unassociate!' );
    else
      Krang.Form.submit('current_contributors_form', { rm: 'unassociate_selected' }, { to_top: false });
  }
</tmpl_if>

<tmpl_if row_count>
  associate_selected = function()
  {
    if ( !Krang.pager_row_checked() )
      alert( 'Nothing selected to associate!' );
    else
      Krang.Form.submit('krang_pager_form', { rm: 'associate_selected' }, { to_top: false });
  }
</tmpl_if>
</script>

<h2>
Associate Contributor
</h2>

<h3>
Current Contributors
</h3>

<tmpl_unless associated_contributors>

  <p class="naught">
  No Contributors.
  </p>

<tmpl_else>

  <form name="current_contributors_form" action="contributor.pl" method="post">

  <input name="rm" value="reorder_contribs" type="hidden">
  <input name="search_filter" value="<tmpl_var escape=html search_filter>" type="hidden">
  <input name="associate_mode" value="<tmpl_var escape=html associate_mode>" type="hidden">
  <input name="krang_pager_curr_page_num" value="<tmpl_var escape=html krang_pager_curr_page_num>" type="hidden">
  <input name="krang_pager_show_big_view" value="<tmpl_var escape=html krang_pager_show_big_view>" type="hidden">
  <input name="krang_pager_sort_field" value="<tmpl_var escape=html krang_pager_sort_field>" type="hidden">
  <input name="krang_pager_sort_order_desc" value="<tmpl_var escape=html krang_pager_sort_order_desc>" type="hidden">

  <div class="table-container">
  <img src="/static/<tmpl_var krang_install_id>/images/corner-top-left.gif" class="left-corner">
  <img src="/static/<tmpl_var krang_install_id>/images/corner-top-right.gif" class="right-corner">
  <table cellspacing="0" class="result select_row" summary="">

  <colgroup>
  <col class="series">
  <col>
  <col>
  <col>
  <col class="series">
  </colgroup>

  <thead>
  <tr>
  <th class="series f">Order</th>
  <th>Last Name</th>
  <th>First, Middle Name</th>
  <th>Type</th>
  <th class="tick l"><input name="checkallbox" value="1" type="checkbox" onclick="Krang.check_all(this,'contrib_unassociate_list')"></th>
  </tr>
  </thead>

  <tbody><tmpl_loop associated_contributors>
    <tr<tmpl_unless __odd__> class="even"</tmpl_unless>>
    <td class="series f"><tmpl_var order_contrib_popup_menu></td>
    <td><tmpl_var escape=html last></td>
    <td><tmpl_var escape=html first><tmpl_if middle>, <tmpl_var escape=html middle></tmpl_if></td>
    <td><tmpl_var escape=html type></td>
    <td class="tick l"><input name="contrib_unassociate_list" value="<tmpl_var escape=html contrib_id>:<tmpl_var escape=html contrib_type_id>" type="checkbox"></td>
    </tr>
  </tmpl_loop>

  <tr class="command-row">
  <td class="f" colspan="4"><input value="Reorder" onclick="reorder_contributors()" type="button" class="button"></td>
  <td class="l"><input value="Unassociate" onclick="unassociate_selected()" type="button" class="button"></td>
  </tr>

  </tbody>

  </table>
  </div>

  </form>

</tmpl_unless>

<tmpl_unless krang_pager_rows>

  <p class="naught">
  No More Contributors Found.
  </p>

<tmpl_else>

  <h3>
  Choose Contributors
  </h3>

  <form name="search_form" action="contributor.pl" method="post">

  <input name="rm" value="search" type="hidden">
  <input name="krang_pager_curr_page_num" value="" type="hidden">
  <input name="krang_pager_show_big_view" value="<tmpl_var escape=html krang_pager_show_big_view>" type="hidden">
  <input name="krang_pager_sort_field" value="<tmpl_var escape=html krang_pager_sort_field>" type="hidden">
  <input name="krang_pager_sort_order_desc" value="<tmpl_var escape=html krang_pager_sort_order_desc>" type="hidden">
  <input name="associate_mode" value="<tmpl_var escape=html associate_mode>" type="hidden">

  <div class="tabset finder">

  <ul class="tabs"><li>
  <b><span>
  Simple Search
  </span></b>
  </li></ul>

  <div class="tabbed">

  <div class="faux-p">
  <input name="search_filter" value="<tmpl_var escape=html search_filter>" class="autocomplete">
  <input value="Search" type="submit" class="button">
  </div>

  </div>

  </div>

  </form>

  <form name="krang_pager_form" action="contributor.pl" method="post">

  <tmpl_include HTMLPager/pager-internals.tmpl>

  <tmpl_include HTMLPager/pager-pagination.tmpl>

  <div class="table-container">
  <img src="/static/<tmpl_var krang_install_id>/images/corner-top-left.gif" class="left-corner">
  <img src="/static/<tmpl_var krang_install_id>/images/corner-top-right.gif" class="right-corner">
  <table cellspacing="0" class="result select_row" summary="">

  <colgroup>
  <col>
  <col>
  <col>
  <col class="series">
  </colgroup>

  <thead>
  <tr>
  <th class="f"><tmpl_var colhead_last></th>
  <th><tmpl_var colhead_first_middle></th>
  <th><tmpl_var colhead_type></th>
  <th class="series l"><tmpl_var colhead_checkbox_column></th>
  </tr>
  </thead>

  <tbody><tmpl_loop krang_pager_rows>
    <tr<tmpl_unless __odd__> class="even"</tmpl_unless>>
    <td class="f" rowspan="<tmpl_var contrib_type_count>"><tmpl_var escape=html last></td>
    <td rowspan="<tmpl_var contrib_type_count>"><tmpl_var escape=html first_middle></td>

    <tmpl_loop contrib_types>
      <tmpl_unless __first__><tr></tmpl_unless>
      <td><tmpl_var escape=html type></td>
      <td class="series l"><input name="krang_pager_rows_checked" value="<tmpl_var escape=html contrib_id>:<tmpl_var escape=html contrib_type_id>" type="checkbox"></td>
      </tr>
    </tmpl_loop>
  </tmpl_loop>

  <tr class="command-row">
  <td class="f" colspan="3">&nbsp;</td>
  <td class="l">
    <tmpl_if row_count><input value="Associate" onclick="associate_selected()" type="button" class="button">
    <tmpl_else>&nbsp;</tmpl_if>
  </td>
  </tr>

  </tbody>

  </table>
  </div>

  <tmpl_include HTMLPager/pager-pagination.tmpl>

  </form>

</tmpl_unless>

<form name="do_return_form" action="<tmpl_if associate_story>story<tmpl_else>media</tmpl_if>.pl" method="post">

<input name="rm" value="edit" type="hidden">

<div class="panel capped">
<input value="Back" type="submit" class="west">
<input value="Add Contributor" onclick="add_contrib()" type="button">
</div>

</form>

<form name="add_contrib_form" action="contributor.pl" method="post">
<input name="rm" value="add" type="hidden">
<input name="search_filter" value="<tmpl_var escape=html search_filter>" type="hidden">
<input name="associate_mode" value="<tmpl_var escape=html associate_mode>" type="hidden">
<input name="krang_pager_curr_page_num" value="<tmpl_var escape=html krang_pager_curr_page_num>" type="hidden">
<input name="krang_pager_show_big_view" value="<tmpl_var escape=html krang_pager_show_big_view>" type="hidden">
<input name="krang_pager_sort_field" value="<tmpl_var escape=html krang_pager_sort_field>" type="hidden">
<input name="krang_pager_sort_order_desc" value="<tmpl_var escape=html krang_pager_sort_order_desc>" type="hidden">
</form>

<tmpl_include footer.tmpl>

