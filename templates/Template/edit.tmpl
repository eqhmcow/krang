<tmpl_include header.tmpl>

<script language="JavaScript" type="text/javascript">
<!-- //

    nav_edit_mode();

    function do_save_stay () {
        var myform = document.edit_template_form;
        myform.rm.value = <tmpl_if add_mode>'add_save_stay'<tmpl_else>'edit_save_stay'</tmpl_if>;
        myform.submit();
    }


    function do_save () {
        var myform = document.edit_template_form;
        myform.rm.value = <tmpl_if add_mode>'add_save'<tmpl_else>'edit_save'</tmpl_if>;
        myform.submit();
    }

                                                                                                       
    function do_checkin () {
        var myform = document.edit_template_form;
        myform.rm.value = <tmpl_if add_mode>'add_checkin'<tmpl_else>'edit_checkin'</tmpl_if>;
        myform.submit();
    }

    function do_cancel () {
        var myform = document.edit_template_form;
        <tmpl_if add_mode>
          myform.rm.value = 'add_cancel';
        <tmpl_else>
          myform.rm.value = 'edit_cancel';
        </tmpl_if>
        myform.submit();
    }

    function do_deploy () {
        alert ("Not implemented yet");
    }


    function do_delete () {
        if (confirm("Are you sure you want to delete this template?")) {
            var myform = document.delete_template_form;<tmpl_if add_mode>
            myform.rm.value = 'cancel_add';</tmpl_if>
            myform.submit();
        }
    }

    function save_and_view_log () {
        var myform = document.edit_template_form;
        myform.rm.value = 'save_and_view_log';
        myform.submit();
    }

    function save_and_edit_schedule () {
        alert("Schedule editor not yet implemented.");
    }

// -->
</script>


<div class="dark-bar">
<span class="left"><tmpl_if add_mode>New<tmpl_else>Edit</tmpl_if> Template</span>
<span class="right"><tmpl_unless add_mode><a href="javascript:save_and_view_log()">Log</a> | </tmpl_unless><a href="javascript:goto_help()">Help</a></span>
</div>

<tmpl_unless add_mode>

<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tr class="light">
  <td width="135">ID:</td>
  <td><tmpl_var template_id></td>
</tr>

<tr class="light">
  <td width="135">Filename:</td>
  <td><tmpl_var filename></td>
</tr>

<tr class="light">
  <td width="135">URL:</td>
  <td><tmpl_var url></td>
</tr>

<tr class="light">
  <td width="135">Current&nbsp;Version:</td>
  <td><tmpl_var version></td>
</tr>

<tr class="light">
  <td width="135">Deployed&nbsp;Version:</td>
  <td><tmpl_unless deployed_version>[n/a]</tmpl_unless><tmpl_var deployed_version></td>
</tr>

</table>

</tmpl_unless>



<div class=form-box>

<table border="0" cellpadding="5" cellspacing="0" width="100%">

<form name="delete_template_form" method="post">
<input type="hidden" name="rm" value="delete">
<input type="hidden" name="template_id" value="<tmpl_var escape=HTML template_id>">
</form>

<form name="edit_template_form" method="POST" enctype="multipart/form-data">
<input type="hidden" name="rm" value=<tmpl_if add_mode>"save_add"<tmpl_else>"save_edit"</tmpl_if>>
<input type="hidden" name="template_id" value="<tmpl_var escape=HTML template_id>">

<tmpl_if add_mode>

<script language="javascript">
  function update_filename (e) {
     var targ = e.form.elements["filename"];
     if (e.selectedIndex == 0) { 
        targ.readOnly = false;
        targ.style.backgroundColor = 'white';
        targ.value = '';
     } else {
        targ.value = e.options[e.selectedIndex].value + ".tmpl";
        targ.readOnly = true;
        targ.style.backgroundColor = '#DDDDDD';
     }
  }
</script>

<tr>
  <td>Element:</td>
  <td colspan="2"><tmpl_if duplicate_url><span class="invalid"></tmpl_if><tmpl_if error_element><span class="invalid"></tmpl_if><tmpl_var element_chooser><tmpl_if error_element></span></tmpl_if><tmpl_if duplicate_url></span></tmpl_if></td>
</tr>

<tr>
  <td>*Filename:</td>
  <td colspan="2"><tmpl_if duplicate_url><span class="invalid"></tmpl_if><tmpl_if error_filename><span class="invalid"></tmpl_if><input type=text name="filename" size=30 value="<tmpl_var escape=html filename>"><tmpl_if error_element></span></tmpl_if><tmpl_if duplicate_url></span></tmpl_if></td>
</tr>

<tr>
  <td>Site/Categories:</td>
  <td colspan="2"><tmpl_if duplicate_url><span class="invalid"></tmpl_if><tmpl_if error_category_id><span class="invalid"></tmpl_if><tmpl_var category_chooser><tmpl_if error_category_id></span></tmpl_if><tmpl_if duplicate_url></span></tmpl_if></td>
</tr>

</tmpl_if>

<tr>
  <td>Upload File:<tmpl_if filename><br />
<tmpl_if template_id><a href="javascript:preview_template('<tmpl_var escape=HTML template_id>')"></tmpl_if><tmpl_var escape=HTML filename><tmpl_if template_id></a></tmpl_if>
<tmpl_var escape=HTML file_size></tmpl_if></td>
  <td colspan="2"><tmpl_if error_template_file><span class="invalid"></tmpl_if><tmpl_var upload_chooser><tmpl_if error_template_file></span></tmpl_if><tmpl_if duplicate_url></span></tmpl_if></td>
</tr>

<tr>
  <td>Template code:</td>
  <td colspan="2"><textarea rows="4" cols="35" name="content"><tmpl_var escape=HTML content></textarea></td>
</tr>

<tmpl_unless add_mode>
<tr>
  <td>Test with Template:</td>
  <td colspan="2"><input name="testing" type="checkbox" value="1" <tmpl_if testing>checked</tmpl_if>></td>
</tr>
</tmpl_unless>

</table>
</div>



<!-- Version Navigation -->
<tmpl_unless add_mode>
<tmpl_var history_return_params>

<script language="javascript">
<!--
  function revert_version () {
    if (confirm("Are you sure you want to discard your work and revert to " +
                "this old version?")) {
        var myform = document.edit_template_form;
        myform.rm.value = 'revert_version';
        myform.submit();
    }
  }

  function view_version () {
      var myform = document.edit_template_form;
      myform.rm.value = 'view_version';
      myform.submit();
  }
// -->
</script>


<div class=form-box>
Version: <tmpl_var version_chooser>
<input type="button" value="Revert" onClick="revert_version()">
<input type="button" value="View" onClick="view_version()">
</div>
</tmpl_unless>
<!-- END Version Navigation -->



<div class="button-bar">
  <input type="button" value="Save" onClick="do_save()">
  <input type="button" value="Save &amp; Stay" onClick="do_save_stay()">
  <input type="button" value="Checkin" onClick="do_checkin()">
  <tmpl_unless add_mode>
  <input type="button" value="Delete" onClick="do_delete()">
  <input type="button" value="Deploy" onClick="do_deploy()">
  </tmpl_unless>
  <input type="reset" value="Reset">
  <input type="button" value="Cancel" onClick="do_cancel()">
</div>


</form>


<tmpl_include footer.tmpl>
