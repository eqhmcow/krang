<tmpl_include header.tmpl>

<script language="javascript" type="text/javascript">

  /* returns true if the user has checked anything */
  something_checked = function () {
      var form = document.krang_pager_form;
      for (i = 0; i < form.elements.length ; i++) {
          var e = form.elements[i];
          if (e.name == "krang_pager_rows_checked" && e.checked) {
             return true;
          }
      }
      return false;
  }

  preview_story = function (id) {
        Preview = window.open("publisher.pl?rm=preview_story&story_id=" + id, "<tmpl_var "instance_name">");
        Preview.focus();
  }

  preview_media = function (id) {
        Preview = window.open("publisher.pl?rm=preview_media&media_id=" + id, "<tmpl_var "instance_name">");
        Preview.focus();
  }

  remove = function (id) {
     if (confirm("Are you sure you wish to delete this item permanently?")) {
       document.krang_pager_form.rm.value = 'delete';
       document.krang_pager_form.id.value = id;
       document.krang_pager_form.submit();
     }
  }

  delete_checked = function () {
     if (something_checked()) {
       if (confirm("Are you sure you wish to delete these items permanently?")) {
         document.krang_pager_form.rm.value = 'delete_checked';
         document.krang_pager_form.submit();
       }
     } else {
          alert("Nothing selected to delete!");
     }
  }

  edit = function (id) {
       document.krang_pager_form.rm.value = 'goto_edit';
       document.krang_pager_form.id.value = id;
       document.krang_pager_form.submit();
  }

  log = function (id) {
       document.krang_pager_form.rm.value = 'goto_log';
       document.krang_pager_form.id.value = id;
       document.krang_pager_form.submit();
  }

  copy = function (id) {
       document.krang_pager_form.rm.value = 'copy';
       document.krang_pager_form.id.value = id;
       document.krang_pager_form.submit();
  }

  publish_checked = function () {
    if (something_checked()) {
      if (confirm("Are you sure you wish to publish all these items?")) {
        document.krang_pager_form.action = 'publisher.pl';
        document.krang_pager_form.rm.value = 'publish_story_list';
        document.krang_pager_form.submit();
      }
    } else {
      alert("Nothing selected to publish!");
    }
  }

  publish_story = function (story_id) {
    var pubform = document.forms["publish_story_form"];
    pubform.story_id.value=story_id;
    pubform.submit();
  }

  publish_media = function (media_id) {
    var pubform = document.forms["publish_media_form"];
    pubform.media_id.value=media_id;
    pubform.submit();
  }

  deploy = function (id) {
       document.krang_pager_form.rm.value = 'deploy';
       document.krang_pager_form.id.value = id;
       document.krang_pager_form.submit();
  }

  checkin = function (id) {
    document.krang_pager_form.rm.value = 'checkin';
    document.krang_pager_form.id.value = id;
    document.krang_pager_form.submit();
  }
                                                                               
  checkin_checked = function () {
     if (something_checked()) {
       document.krang_pager_form.rm.value = 'checkin_checked';
       document.krang_pager_form.submit();
     } else {
       alert("Nothing selected to checkin!");
     }
  }

  update_testing = function (checkbox, id) {
       document.krang_pager_form.rm.value = 'update_testing';
       document.krang_pager_form.id.value = id;
       document.krang_pager_form.submit();
  }

</script>

<div class="dark-bar"><p class="left">&nbsp;My Workspace</p><p class="right"><a href="javascript:openWin('help.pl?topic=workspace')">Help</a>&nbsp;</p></div>

<!-- publish_story form -->
<form name="publish_story_form" method="GET" action="publisher.pl">
<input type=hidden name="rm" value="publish_story">
<input type=hidden name="story_id" value="">
</form>

<!-- publish_media form -->
<form name="publish_media_form" method="GET" action="publisher.pl">
<input type=hidden name="rm" value="publish_media">
<input type=hidden name="media_id" value="">
</form>


<form name="krang_pager_form" method="POST" action="workspace.pl">
  <input type="hidden" name="rm">
  <input type="hidden" name="id">
<tmpl_include HTMLPager/pager-internals.tmpl>

<tmpl_if krang_pager_rows>

<div class="boxb">
<div class="light">
  Sort By: &nbsp;&nbsp; <tmpl_var sort_select></div>

<div class="button-bar">
  <div style="float:left;"><input type="button" value="Delete Checked" onclick="delete_checked()" class="button"></div>
  <input type="button" value="Check In" onclick="checkin_checked()" class="button">
  <tmpl_if may_publish><input type="button" value="Publish" onclick="publish_checked()" class="button"></tmpl_if>
</div>

<div class="no-border" style="height: 20px"><p class="left">Showing <tmpl_var start_row> to <tmpl_var end_row> of <tmpl_var found_count></p><p class="right"><tmpl_var colhead_checkbox_column></p></div>

<tmpl_loop krang_pager_rows>
  <table class="form-head">

<tr>
    <td width="127"><tmpl_if is_story><b>Story</b> <tmpl_var story_id></tmpl_if>
        <tmpl_if is_media><b>Media</b> <tmpl_var media_id></tmpl_if>
        <tmpl_if is_template><b>Template</b> <tmpl_var template_id></tmpl_if>
        v<tmpl_var version>&nbsp;&nbsp;&nbsp;
    </td>
    <td><b><tmpl_var title></td></b>
    <td align="right">
      <tmpl_if may_edit><tmpl_var checkbox_column></tmpl_if>
    </td>
  </tr></table>

    <table cellspacing="0" width="571" class="form-cell">
     <tmpl_if is_story>
       <tr>
          <td class="form-cell" width="120" style="border-bottom:none;">Type</td>
          <td class="form-cell" style="border-bottom:none;"><tmpl_var story_type></td>
		<tr>
        <td class="form-cell" style="border-top:none;" width="120">URL</td>
        <td class="form-cell" style="border-top:none;"><tmpl_var url></td>
     </tmpl_if>
	   <tmpl_if is_media>
     <tr>
        <td class="form-cell" width="120">URL</td>
        <td class="form-cell"><tmpl_var url></td>
		 </tmpl_if> 
		 <tmpl_if is_template>
     <tr>
        <td class="form-cell" width="120">URL</td>
        <td class="form-cell"><tmpl_var url></td>
		 </tmpl_if>
        <tmpl_if thumbnail>
          <td width="50" align=center class="form-cell">
            <a href="javascript:preview_media(<tmpl_var media_id>)"><img src="<tmpl_var thumbnail>" border="0"></a>
          </td>
        </tmpl_if>
     </tr>
     <tr>
       <td colspan=<tmpl_if thumbnail>"3"<tmpl_else>"2"</tmpl_if> class="form-cell">
           <span style="float:right; font-weight: bold;"><tmpl_if may_edit><tmpl_var command_column><tmpl_else><a href="javascript:log('<tmpl_var id>')">Log</a></tmpl_if></span>
           <tmpl_if may_edit>
           <tmpl_if is_story>
               <input type="button" value="Copy" onclick="copy('<tmpl_var id>')" class="button">
               <tmpl_if may_publish><input type="button" value="Publish" onclick="publish_story('<tmpl_var id>')" class="button"></tmpl_if>
              <br><br>
               Desk: <select name="checkin_to_<tmpl_var id>"><tmpl_loop desk_loop><option value="<tmpl_var choice_desk_id>"><tmpl_var choice_desk_name></tmpl_loop></select> <input type="button" value="Check In" onclick="checkin('<tmpl_var id>')" class="button">
           </tmpl_if>
           <tmpl_if is_media>
               <tmpl_if may_publish><input type="button" value="Publish" onclick="publish_media('<tmpl_var id>')" class="button"></tmpl_if>
                <br><br>
               <input type="button" value="Check In" onclick="checkin('<tmpl_var id>')" class="button">
           </tmpl_if>
           <tmpl_if is_template>
               <input type="button" value="Deploy" onclick="deploy('<tmpl_var id>')" class="button">
                <br><br>
               <input type="button" value="Check In" onclick="checkin('<tmpl_var id>')" class="button">
               Test with: <input onchange="update_testing(this, '<tmpl_var id>')" type="checkbox" <tmpl_if testing>checked</tmpl_if> name=testing_<tmpl_var id> value='1'>
           </tmpl_if>
           </tmpl_if>
       </td>
     </tr>
  </table>

  </tmpl_loop>
<div class="no-border"><p class="left2"><tmpl_if prev_page_number><a href="javascript:go_page('<tmpl_var prev_page_number>')">&lt;&lt;</a></tmpl_if>

<tmpl_loop page_numbers>
  <tmpl_if is_current_page><b><tmpl_var page_number></b>
  <tmpl_else><a href="javascript:go_page('<tmpl_var page_number>')"><tmpl_var page_number_label></a>
  </tmpl_if>
  <tmpl_unless __last__>|</tmpl_unless>
</tmpl_loop>

<tmpl_if next_page_number><a href="javascript:go_page('<tmpl_var next_page_number>')">&gt;&gt;</a></tmpl_if>

  <tmpl_if show_big_view><a href="javascript:show_big_view('0')">show <tmpl_var user_page_size> per page</a>
  <tmpl_else><a href="javascript:show_big_view('1')">show <tmpl_var big_view_page_size> per page</a>
  </tmpl_if></p></div></div>

<div class="button-bar">
  <div style="float:left;"><input type="button" value="Delete Checked" onclick="delete_checked()" class="button"></div>
  <input type="button" value="Check In" onclick="checkin_checked()" class="button">
  <tmpl_if may_publish><input type="button" value="Publish" onclick="publish_checked()" class="button"></tmpl_if>
</div>
</tmpl_if>
</form>
</div>
<tmpl_include footer.tmpl>
