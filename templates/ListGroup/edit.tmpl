<tmpl_include /header.tmpl>


<script language="Javascript">
<!-- //

    <tmpl_var js_list_arrays>
    function populate_list (list_count) {

        var next_list = list_count + 1;

        // first, clear lists above one selected
        clear_lists_above(next_list);

        if ( list_count != 0 ) {
            var select_val = get_selected_val(list_count);
        
            var count = 0;
            for(var key in eval('list_data[' + select_val + ']') ) {
                if (eval('list_data[' + select_val + "][key]['__data__']") ) {
                    eval ('document.forms["edit_form"].list_' + next_list + '.options[' + count++ + '] = new Option(' + "'" + eval("list_data[" + select_val + "][key]['__data__']") + "', '" + select_val + '][' + key + "')");
                }
            }
        } else {
            var count = 0;
            for(var key in list_data) {
               if (list_data[key]['__data__']) {
                    eval ('document.forms["edit_form"].list_1.options[' + count++ + '] = new Option(' + "'" + eval("list_data[key]['__data__']") +  "', '" + key + "')"); 
               }
            }
        }
    }

    function clear_lists_above(list_count) {
        for ( var c = list_count; c <= <tmpl_var list_levels>; c++ ) {
            eval ('document.forms["edit_form"].list_' + c + '.options.length = 0'); 
        }
    }

    function get_selected_val (list_count) {
        var sindex = eval( 'document.forms["edit_form"].list_' + list_count + '.selectedIndex' );
        if (sindex > -1) {
            return eval ('document.forms["edit_form"].list_' + list_count + '.options[' + sindex + '].value');
        } else {
            return('undef');
        }
    };

    nav_edit_mode();

    function do_save () {
        var myform = document.forms["edit_form"];
        myform.rm.value = "save";
        myform.submit();
    }


    function save_stay () {
        var myform = document.forms["edit_form"];
        myform.rm.value = "save_stay";
        myform.submit();
    }


    function do_delete (list_count) {
        var select_val = get_selected_val(list_count);
        eval( "list_data[" + select_val + "]['__data__'] = []");
        eval( "list_data[" + select_val + "] = []");
        populate_list(list_count-1);
    }

    function do_replace(list_count) {
        var select_val = get_selected_val(list_count);
        if ( eval("document.forms['edit_form'].new_item_" + list_count + ".value" ) ) {
            eval( "list_data[" + select_val + "]['__data__'] = document.forms['edit_form'].new_item_" + list_count + ".value" ); 
            populate_list(list_count-1);
            eval( "document.forms['edit_form'].new_item_" + list_count + ".value = ''");
        }
    }

    function do_add(list_count) {
        var select_val = get_selected_val(list_count);
        if (select_val != 'undef' ) {
            var indexArray = select_val.split('][');
            var last_index = indexArray.pop();
            select_val = indexArray.join('][');
            var firstHalf;
            var secondHalf;
            if (! select_val) {
                firstHalf = eval( 'list_data.slice(0, ' + last_index + ')' );
                secondHalf = eval( 'list_data.slice(' + last_index + ')' );
            } else {
                 firstHalf = eval( 'list_data[' + select_val + '].slice(0, ' + last_index + ')' );
                secondHalf = eval( 'list_data[' + select_val + '].slice(' + last_index + ')' );
            }

            var t = new Array();
            t['__data__'] = eval( "document.forms['edit_form'].new_item_" + list_count + ".value" );
            secondHalf.unshift(t);
            if (! select_val) {
                list_data = firstHalf.concat(secondHalf);
            } else {
                eval( 'list_data[' + select_val + '] = firstHalf.concat(secondHalf)' );
            } 
        } else {
            select_val = get_selected_val(list_count - 1);
            
            if( ! eval( 'list_data[' + select_val + '][0]') ) {
                eval( 'list_data[' + select_val + '][0] = new Array()' );
                eval( 'list_data[' + select_val + "][0]['__data__'] = document.forms['edit_form'].new_item_" + list_count + ".value" ); 
            }
        }
         
        populate_list(list_count-1);
    }
    
// -->
</script>


<table border="0" cellpadding="2" cellspacing="0" width="100%">
<tr class="dark-bar">
  <td>&nbsp;LIST GROUP EDIT - <tmpl_var list_group_name></td>
  <td align="right"><a href="javascript:goto_help()">Help</a>&nbsp;</td>
</tr>
</table>

<form name="edit_form" method="GET" action="list_group.pl">
<table border="1" cellpadding="2" cellspacing="0" width="100%">
<tr><td width="150">Description:</td><td width="400"><textarea rows="4" cols="60"><tmpl_var list_group_description></textarea></td></tr>
<tr class="light-bar"><td colspan=2>LISTS</td></tr>
<tmpl_loop list_loop>
<tr><td><tmpl_var list_name></td><td><select name="list_<tmpl_var list_count>" size="10" onChange="populate_list(<tmpl_var list_count>)">
<tmpl_if list_item_loop><tmpl_loop list_item_loop><option value="<tmpl_var order>"><tmpl_var data></tmpl_loop></tmpl_if></select>
<br><input type="text" name="new_item_<tmpl_var list_count>">
<input type="button" value="Add" onClick="do_add(<tmpl_var list_count>)" class="button">
<input type="button" value="Replace" onClick="do_replace(<tmpl_var list_count>)" class="button">
<input type="button" value="Delete Selected" onClick="do_delete(<tmpl_var list_count>)" class="button">
</td></tr>
</tmpl_loop>
</table>
<div class="button-bar">
    <input type="submit" value="Save" onClick="do_save()" class="button">
    <input type="button" value="Save &amp; Stay" onClick="save_stay()" class="button">
</div>


<!-- End edit_form -->
</form>


<tmpl_include /footer.tmpl>
