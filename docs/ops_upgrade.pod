
=head1 Upgrading PIRT CMS 2.0 (Krang)


This document describes how to upgrade Krang.


To upgrade an existing Krang installation, do the following as root:


  # cd <new Krang src directory>
  # ./bin/krang_upgrade


=head2 Optional parameters

=over

=item krangRoot

Defaults to F</usr/local/krang> if not specified.  May be used to 
specify a different location if need be.

  # ./bin/krang_upgrade --krangRoot $KRANG_ROOT

=back




=head2 What Upgrade Will Do


Following is a list of the tasks the upgrade script will perform.


=over 4

=item Validate path to KRANG_ROOT.

=item Locate and parse existing krang.conf file.

=item Verify sufficient disk space

=over 4

=item Required space = KRANG_ROOT + Instance MySQL folders

=back


=item Verify that this Krang has been shut down.

=item Verify that no backup KRANG_ROOT exists.

=item Rename existing KRANG_ROOT to KRANG_ROOT + ".backup".

=item Shut down MySQL

=item Copy existing Krang MySQL database folders to folder + ".backup".

=item Restart MySQL

=item Install new Krang system to KRANG_ROOT.

=item Copy krang.conf, data/* from backup to new KRANG_ROOT.

=item Apply upgrade scripts.

=over 4

=item E.g., "KRANG_ROOT/upgrade/V1_2.pm"

=item Run class methods C<per_installation()> and C<per_instance()>

=back


=item Clear out sessions from database.

=item Make test on new system.

=over 4

=item If failure, recommend C<krang_upgrade --rollback>

=back


=item Output results of upgrade to console.

=over 4

=item Show rollback directory paths for KRANG_ROOT and database

=back

=back




=head2 Components to consider when upgrading

There are a number of sub-systems which have to be considered when
upgrading a Krang installation.

=over 4

=item Krang System

Stored in KRANG_ROOT, the system is that which is not otherwise
specified.  This includes the Perl libraries (internal and external),
Apache, htdocs, element set libraries, etc.


=item krang.conf

The elements in the krang.conf file may have changed since the
previous version.  The installer must create a new krang.conf,
incorporating the existing directives but installing the new
directives.  This is usually accomplished by appending new directives
to the end of the existing krang.conf. 


=item Instance Databases

Database tables may have changed, and data may have to be transformed
during upgrade.  The upgrade system will start with the existing
database and apply progressive upgrades in order to bring each
database up to date.

N.B.:  Each instance has its own database which must be upgraded.


=item Data files

Media and Templates are stored in the KRANG_ROOT/data directory.  They
will be copied over from the existing installation.  Upgrade scripts
may alter the content of the data directory.


=back



=head1 System Requirements

This upgrade is intended for sites which are already running Krang, aka
PIRT CMS 2.0.

Upgrade from Bricolage is handled through a different system.


=head1 To Upgrade


=over 4

=item Down load and uncompress new Krang to temporary folder (e.g., /tmp/new_krang/)

=item Run the upgrade script as root

  # cd <new Krang src directory>
  # ./bin/krang_upgrade --krangRoot $KRANG_ROOT

=back
