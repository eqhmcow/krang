<tmpl_include /header.tmpl>


<script language="Javascript">
<!-- //

    nav_edit_mode();

    /* Start Krangolage */
    function cleanOpt (field) {
        for (var i = 0; i < field.length; i++) {
            if (field[i].value == "__") {
                field[i] = null;
            }
        }
    }

    function add_group () {
        var myform = document.forms["edit_user_form"];
        var right = myform['current_group_ids'];
        var left = myform['possible_group_ids'];
        var new_left = new Array();
        new_left.length = 0;
        cleanOpt(left);

        for (var i = 0; i < left.length; i++) {
            var opt = new Option(left[i].text, left[i].value);
            if (left[i].selected) {
                right[right.length] = opt;
            } else {
                new_left[new_left.length] = opt;
            }
        }

        for (var i = 0; i < left.length; i++) {
            left[i] = null;
        }

        if (new_left.length == 0) {
            left.length = 1;
            left[0] = new Option('','__');
        } else {
            left.length = new_left.lengt;
        }

        for (var i = 0; i < new_left.length; i++) {
            left[i] = new_left[i];
        }

        cleanOpt(left);
    }

    function remove_group () {
        var myform = document.forms["edit_user_form"];
        var right = myform['current_group_ids'];
        var left = myform['possible_group_ids'];
        var new_left = new Array();
        var new_right = new Array();
        var count = 0;
        cleanOpt(left);

        for (var i = 0; i < right.length; i++) {
            var opt = new Option(right[i].text, right[i].value);
            if (right[i].selected) {
                new_left[new_left.length] = opt;
            } else {
                new_right[count++] = opt;
            }
        }

        right.length = new_right.length;

        for (var i = 0; i < count; i++) {
            right[i] = new_right[i];
        }

        for (var i = 0; i < new_left.length; i++) {
            left[left.length] = new_left[i];
        }
    }

    function get_group_ids () {
        var myform = document.forms["edit_user_form"];
        var right = myform['current_group_ids'];
        for (var i = 0; i < right.length; i++) {
	    right[i].selected = 1;
        }
    }
    /* End Krangolage */

    function save_stay () {
        var myform = document.forms["edit_user_form"];
      <tmpl_if add_mode>
        myform.rm.value = "save_stay_add";
      <tmpl_else>
        myform.rm.value = "save_stay_edit";
      </tmpl_if>
        get_group_ids();
        myform.submit();
    }


    function cancel_user_change () {
        var myform = document.forms["edit_user_form"];
      <tmpl_if add_mode>
        myform.rm.value = "cancel_add";
      <tmpl_else>
        myform.rm.value = "cancel_edit";
      </tmpl_if>
        myform.submit();
    }


    function delete_user () {
        var myform = document.forms["edit_user_form"];
        if (confirm("Are you SURE you want to delete this user?")) {
            myform.rm.value = "delete";
            myform.submit();
        }
    }

// -->
</script>


<div class="dark-bar">User <tmpl_if add_mode>Add<tmpl_else>Edit</tmpl_if></div>


<div class=form-box>

<table cellpadding="5" cellspacing="0">


<form name="edit_user_form" method="POST">
<input type="hidden" name="search_filter" value="<tmpl_var ESCAPE=HTML search_filter>">
<tmpl_if add_mode>
  <input type="hidden" name="rm" value="save_add">
<tmpl_else>
  <input type="hidden" name="rm" value="save_edit">
  <input type="hidden" name="user_id" value="<tmpl_var escape=HTML user_id>">
</tmpl_if>

<!-- Krang::HTMLPager params -->
<input type="hidden" name="krang_pager_curr_page_num" value="<tmpl_var ESCAPE=HTML krang_pager_curr_page_num>">
<input type="hidden" name="krang_pager_show_big_view" value="<tmpl_var ESCAPE=HTML krang_pager_show_big_view>">
<input type="hidden" name="krang_pager_sort_field" value="<tmpl_var ESCAPE=HTML krang_pager_sort_field>">
<input type="hidden" name="krang_pager_sort_order_desc" value="<tmpl_var ESCAPE=HTML krang_pager_sort_order_desc>">

<tr>
    <td align="left" valign="top">*First:</td>
    <td align="left" valign="top"><tmpl_if error_invalid_first_name><span class="invalid"></tmpl_if><tmpl_if duplicate_first_name><span class="invalid"></tmpl_if><input type="textfield" size="40" name="first_name" value="<tmpl_var escape=HTML first_name>"><tmpl_if error_invalid_first_name></span></tmpl_if><tmpl_if duplicate_first_name></span></tmpl_if></td>
</tr>

<tr>
    <td align="left" valign="top">*Last:</td>
    <td align="left" valign="top"><tmpl_if error_invalid_last_name><span class="invalid"></tmpl_if><tmpl_if duplicate_last_name><span class="invalid"></tmpl_if><input type="textfield" size="40" name="last_name" value="<tmpl_var escape=HTML last_name>"><tmpl_if error_invalid_last_name></span></tmpl_if><tmpl_if duplicate_last_name></span></tmpl_if></td>
</tr>

<tr>
    <td align="left" valign="top">*Email:</td>
    <td align="left" valign="top"><tmpl_if error_invalid_email><span class="invalid"></tmpl_if><input type="textfield" size="40" name="email" value="<tmpl_var escape=HTML email>"><tmpl_if error_invalid_email></span></tmpl_if></td>
</tr>

<tr>
    <td align="left" valign="top">Phone:</td>
    <td align="left" valign="top"><input type="textfield" size="40" name="phone" value="<tmpl_var escape=HTML phone>"></td>
</tr>

<tr>
    <td align="left" valign="top">Mobile Phone:</td>
    <td align="left" valign="top"><input type="textfield" size="40" name="mobile_phone" value="<tmpl_var escape=HTML mobile_phone>"></td>
</tr>

<tr>
  <td align="left" valign="top">User Groups:</td>
  <td align="left" valign="top">
    <table align="center" border="0" valign="top">
      <tr>
        <td align="left" valign="top">
	<div align="center">
	<b>Available Groups</b><br />
	<select name="possible_group_ids" size="<tmpl_var size>" multiple="multiple">
	<tmpl_loop possible_group_ids><option value="<tmpl_var id>"><tmpl_var name></option>
	</tmpl_loop>
	</select>
	<br /><input name="add_grp" onClick="add_group();" type="button" value="Add Group">
	</div>
        </td>
        <td width="25">&nbsp;</td>
        <td align="right" valign="top">
	<div align="center">
	<b>Current Groups</b><br />
<tmpl_if error_missing_group><span class="invalid"></tmpl_if>
<tmpl_if error_null_group><span class="invalid"></tmpl_if>
<tmpl_if error_invalid_group_id><span class="invalid"></tmpl_if>
<select name="current_group_ids" size="<tmpl_var size>" multiple="multiple">
	<tmpl_loop current_group_ids><option value="<tmpl_var id>"><tmpl_var name></option>
	</tmpl_loop>
	</select>
<tmpl_if error_null_group></span></tmpl_if>
<tmpl_if error_invalid_group_id></span></tmpl_if>
<tmpl_if error_missing_group></span></tmpl_if>
	<br /><input name="rm_grp" onClick="remove_group();" type="button" value="Remove Group">
	</div>
	</td>
      </tr>
    </table>
  </td>
</tr>

<tr>
    <td align="left" valign="top">*Login:</td>
    <td align="left" valign="top"><tmpl_if duplicate_login><span class="invalid"></tmpl_if><tmpl_if error_invalid_login><span class="invalid"></tmpl_if><input type="textfield" size="40" name="login" value="<tmpl_var escape=HTML login>"><tmpl_if error_invalid_login></span></tmpl_if><tmpl_if duplicate_login></span></tmpl_if></td>
</tr>

<tr>
    <td align="left" valign="top"><tmpl_if add_mode>*</tmpl_if>New Password:</td>
    <td align="left" valign="top"><tmpl_if error_null_password><span class="invalid"></tmpl_if><tmpl_if duplicate_password><span class="invalid"></tmpl_if><tmpl_if error_password_mismatch><span class="invalid"></tmpl_if><input type="password" size="40" name="new_password" value="<tmpl_var new_password>"><tmpl_if duplicate_password></span></tmpl_if><tmpl_if error_password_mismatch></span></tmpl_if><tmpl_if error_null_password></span></tmpl_if></td>
</tr>

<tr>
    <td align="left" valign="top"><tmpl_if add_mode>*</tmpl_if>Confirm New Password:</td>
    <td align="left" valign="top"><tmpl_if error_null_password><span class="invalid"></tmpl_if><tmpl_if duplicate_password><span class="invalid"></tmpl_if><tmpl_if error_password_mismatch><span class="invalid"></tmpl_if><input type="password" size="40" name="confirm_password" value="<tmpl_var confirm_password>"><tmpl_if duplicate_password></span></tmpl_if><tmpl_if error_password_mismatch></span></tmpl_if><tmpl_if error_null_password></span></tmpl_if></td>
</tr>
</table>
</div>

<div class="button-bar">
    <input type="submit" onClick="get_group_ids()" value="Save">
    <tmpl_unless associate_mode><input type="button" value="Save &amp; Stay" onClick="save_stay()"></tmpl_unless>
    <input type="reset" value="Reset">
    <tmpl_unless add_mode><input type="button" value="Delete" onClick="delete_user()"></tmpl_unless>
    <input type="button" value="Cancel" onClick="cancel_user_change()">
</div>


<!-- End edit_user_form -->
</form>


<tmpl_include /footer.tmpl>
