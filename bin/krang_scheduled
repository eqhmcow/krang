#!/usr/bin/perl

use strict;
use warnings;

use Config;
use File::Spec;

BEGIN {
    my $lib = File::Spec->catfile($ENV{KRANG_ROOT}, 'lib');
    $ENV{PERL5LIB} = $ENV{PERL5LIB} ? "$ENV{PERL5LIB}:${lib}" : "${lib}";
    unshift @INC, $lib, "$lib/".$Config{archname};
}

# setup first instance by default, schedule daemon works on all
# instances but Krang::Script isn't happy picking one anymore.
use Krang::Conf;
BEGIN { $ENV{KRANG_INSTANCE} = (Krang::Conf->instances)[0]; }

use Krang::Schedule::Daemon;
use Krang::Script;
use Krang::Log qw(critical);

eval { Krang::Schedule::Daemon->run };
if (my $err = $@) {
    critical($err);
    die $@;
}
